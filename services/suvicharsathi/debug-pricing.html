<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Pricing Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Debug Pricing Test</h1>
        <p>This page will help identify the exact issue with pricing functionality.</p>
        
        <div class="card p-4">
            <h3>Monthly Plan Test</h3>
            <button class="btn btn-primary subscribe-btn" 
                    data-plan="monthly" 
                    data-amount="49" 
                    data-duration="monthly">
                Subscribe Monthly ‚Çπ49
            </button>
        </div>
        
        <div class="mt-4">
            <h4>Debug Log:</h4>
            <div id="debugLog" style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace;"></div>
        </div>
    </div>

    <script>
        // Debug logging function
        function log(message) {
            console.log(message);
            const logDiv = document.getElementById('debugLog');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
        }

        log('üöÄ Debug page loaded');

        // Test if APIService is available
        try {
            if (typeof APIService !== 'undefined') {
                log('‚úÖ APIService class found');
                const api = new APIService();
                log('‚úÖ APIService instance created');
                log('üîê Is authenticated: ' + api.isAuthenticated());
            } else {
                log('‚ùå APIService class not found');
            }
        } catch (error) {
            log('‚ùå Error with APIService: ' + error.message);
        }

        // Test button click detection
        document.addEventListener('DOMContentLoaded', function() {
            log('üìÑ DOM loaded');
            
            const button = document.querySelector('.subscribe-btn');
            if (button) {
                log('‚úÖ Subscribe button found');
                
                button.addEventListener('click', function(event) {
                    log('üéØ Button clicked: ' + button.dataset.plan);
                    
                    // Test the exact function that should be called
                    try {
                        // Simulate what happens in pricing.js
                        log('üìù Testing handleSubscription logic...');
                        
                        const plan = button.dataset.plan;
                        const amount = parseInt(button.dataset.amount);
                        const duration = button.dataset.duration;
                        
                        log('üìä Plan details: ' + JSON.stringify({plan, amount, duration}));
                        
                        // Test authentication check
                        if (typeof api !== 'undefined' && api) {
                            log('üîç Checking authentication...');
                            const isAuth = api.isAuthenticated();
                            log('üîê Authentication result: ' + isAuth);
                            
                            if (!isAuth) {
                                log('‚ùå User not authenticated - would show modal');
                                alert('Would show auth modal (user not logged in)');
                            } else {
                                log('‚úÖ User authenticated - would proceed to payment');
                                alert('Would proceed to payment (user logged in)');
                            }
                        } else {
                            log('‚ùå API not available for auth check');
                            alert('API not available for authentication check');
                        }
                        
                    } catch (error) {
                        log('‚ùå Error in test logic: ' + error.message);
                        log('‚ùå Error stack: ' + error.stack);
                    }
                });
            } else {
                log('‚ùå Subscribe button not found');
            }
        });
    </script>

    <!-- Load the actual JS files to test -->
    <script src="assets/js/shared.js"></script>
    <script src="assets/js/api.js"></script>
    
    <script>
        // Additional test after scripts load
        setTimeout(() => {
            log('‚è∞ Post-load test after 1 second');
            log('üîç APIService available: ' + (typeof APIService !== 'undefined'));
            log('üîç Window.api available: ' + (typeof window.api !== 'undefined'));
        }, 1000);
    </script>
</body>
</html>
