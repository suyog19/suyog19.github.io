<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick API Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-3">
        <h3>Quick API Diagnostic</h3>
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5>Test Registration OTP</h5>
                        <form id="quickTest">
                            <div class="mb-2">
                                <label>Phone:</label>
                                <input type="text" id="testPhone" class="form-control" value="+919999999999">
                            </div>
                            <div class="mb-2">
                                <label>Name:</label>
                                <input type="text" id="testName" class="form-control" value="Test User">
                            </div>
                            <button type="submit" class="btn btn-primary">Send Test OTP</button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5>Response Log</h5>
                        <div id="responseLog" style="max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 0.8em;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/js/api.js"></script>
    <script>
        const api = new APIService();
        const logDiv = document.getElementById('responseLog');

        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const color = {
                'error': 'text-danger',
                'success': 'text-success',
                'warning': 'text-warning',
                'info': 'text-info'
            }[type] || 'text-dark';
            
            logDiv.innerHTML += `<div class="${color}">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // Override console methods to capture logs
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            log('LOG: ' + args.join(' '), 'info');
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            log('ERROR: ' + args.join(' '), 'error');
            originalError.apply(console, args);
        };

        document.getElementById('quickTest').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const phone = document.getElementById('testPhone').value;
            const name = document.getElementById('testName').value;
            
            log('=== Starting OTP Test ===', 'info');
            log(`Phone: ${phone}, Name: ${name}`, 'info');
            
            try {
                const result = await api.sendRegistrationOTP(phone, name, '');
                
                if (result.success) {
                    log('‚úÖ OTP sent successfully!', 'success');
                    log('Response: ' + JSON.stringify(result.data, null, 2), 'success');
                } else {
                    log('‚ùå OTP failed: ' + result.error, 'error');
                }
            } catch (error) {
                log('üí• Exception: ' + error.message, 'error');
            }
            
            log('=== Test Complete ===', 'info');
        });
        
        // Test connection on load
        window.addEventListener('load', async () => {
            log('üöÄ Testing backend connection...', 'info');
            log('Backend URL: ' + api.baseURL, 'info');
            
            try {
                const response = await fetch(api.baseURL);
                log(`‚úÖ Backend reachable: ${response.status} ${response.statusText}`, 'success');
            } catch (error) {
                log(`‚ùå Backend not reachable: ${error.message}`, 'error');
            }
        });
    </script>
</body>
</html>
